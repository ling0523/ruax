!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Ruax={})}(this,(function(e){"use strict";var t=Object.defineProperty,o=(e,o,s)=>(((e,o,s)=>{o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s})(e,"symbol"!=typeof o?o+"":o,s),s);e.default=class{constructor(){o(this,"defaults"),this.defaults={baseUrl:"",url:"",data:{},type:"get",timeout:8e3,dataType:"json",jsonpCallback:"callback",headers:{},contentType:"application/x-www-form-urlencoded",processData:!0,cache:!0,async:!0,withCredentials:!1,beforeSend:null,complete:null,onProgress:null,cancelRequest:null,beforeRequest:null,beforeResponse:null}}__getValidatedConfig(e){let t=JSON.parse(JSON.stringify(this.defaults));return"object"==typeof e&&e&&("string"==typeof e.baseUrl&&(t.baseUrl=e.baseUrl),"string"==typeof e.url&&(t.url=e.url),"object"==typeof e.data&&e.data&&Object.assign(t.data,e.data),"string"==typeof e.type&&(t.type=e.type),"number"!=typeof e.timeout||isNaN(e.timeout)||(t.timeout=e.timeout),"string"==typeof e.dataType&&["STRING","XML","HTML","JSON","BLOB","JSONP"].includes(e.dataType.toLocaleUpperCase())&&(t.dataType=e.dataType),"string"==typeof e.jsonpCallback&&(t.jsonpCallback=e.jsonpCallback),"object"==typeof e.headers&&e.headers&&Object.assign(t.headers,e.headers),"string"!=typeof e.contentType&&!1!==e.contentType||(t.contentType=e.contentType),"boolean"==typeof e.processData&&(t.processData=e.processData),"boolean"==typeof e.cache&&(t.cache=e.cache),"boolean"==typeof e.async&&(t.async=e.async),"boolean"==typeof e.withCredentials&&(t.withCredentials=e.withCredentials),"function"==typeof e.beforeSend&&(t.beforeSend=e.beforeSend),"function"==typeof e.complete&&(t.complete=e.complete),"function"==typeof e.onProgress&&(t.onProgress=e.onProgress),"function"==typeof e.cancelRequest&&(t.cancelRequest=e.cancelRequest),"function"==typeof e.beforeRequest&&(t.beforeRequest=e.beforeRequest),"function"==typeof e.beforeResponse&&(t.beforeResponse=e.beforeResponse)),t}__getParams(e){let t=[];for(let o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}create(e){if("function"==typeof(e=this.__getValidatedConfig(e)).beforeRequest&&void 0===(e=e.beforeRequest.apply(this,[e])))throw new Error("The beforeRequest function must return config");return new Promise(((t,o)=>{if("jsonp"==e.dataType.toLocaleLowerCase()){"function"==typeof e.beforeSend&&e.beforeSend.apply(this);let s=("jsonp_"+Math.random()).replace(".",""),n=document.getElementsByTagName("head")[0];e.data[e.jsonpCallback]=s;let a=document.createElement("script");n.appendChild(a),window[s]=o=>{if("function"==typeof e.complete&&e.complete.apply(this),n.removeChild(a),clearTimeout(a.timer),window[s]=null,"function"==typeof e.beforeResponse){let s=e.beforeResponse.apply(this,[{response:o,config:e}]);t(s instanceof Promise?s:o)}else t(o)},(e.baseUrl+e.url).indexOf("?")>-1?a.src=e.baseUrl+e.url+"&"+this.__getParams(e.data):a.src=e.baseUrl+e.url+"?"+this.__getParams(e.data),a.timer=setTimeout((()=>{"function"==typeof e.complete&&e.complete.apply(this),window[s]=null,n.removeChild(a);const r=new Error("timeout of "+e.timeout+"ms exceeded");if("function"==typeof e.beforeResponse){let s=e.beforeResponse.apply(this,[{config:e,error:r}]);s instanceof Promise?t(s):o(r)}else o(r)}),e.timeout)}else{let s=new XMLHttpRequest;if("blob"==e.dataType.toLocaleLowerCase()&&(s.responseType="blob"),s.onreadystatechange=()=>{if(4==s.readyState){if("function"==typeof e.complete&&e.complete.apply(this,[s]),200==s.status){let a=null;if("json"==e.dataType.toLocaleLowerCase())try{a=JSON.parse(s.responseText)}catch(n){o(n)}else a="xml"==e.dataType.toLocaleLowerCase()?s.responseXML:"html"==e.dataType.toLocaleLowerCase()||"string"==e.dataType?s.responseText:"blob"==e.dataType.toLocaleLowerCase()?s.response:s.responseText;if("function"==typeof e.beforeResponse){let o=e.beforeResponse.apply(this,[{response:a,xhr:s,config:e}]);t(o instanceof Promise?o:a)}else t(a)}else if(0!=s.status){const n=new Error("Request failed with status code "+s.status);if("function"==typeof e.beforeResponse){let a=e.beforeResponse.apply(this,[{xhr:s,config:e,error:n}]);a instanceof Promise?t(a):o(n)}else o(n)}}else 1==s.readyState&&"function"==typeof e.beforeSend&&e.beforeSend.apply(this,[s])},s.ontimeout=()=>{const n=new Error("timeout of "+e.timeout+"ms exceeded");if("function"==typeof e.beforeResponse){let a=e.beforeResponse.apply(this,[{xhr:s,config:e,error:n}]);a instanceof Promise?t(a):o(n)}else o(n)},s.upload.onprogress=t=>{"function"==typeof e.onProgress&&e.onProgress.apply(this,[t])},"get"==e.type.toLocaleLowerCase()){this.__getParams(e.data)?s.open("GET",e.baseUrl+e.url+"?"+this.__getParams(e.data),e.async):s.open("GET",e.baseUrl+e.url,e.async),e.async&&(s.timeout=e.timeout);for(let t in e.headers)s.setRequestHeader(t,e.headers[t]);"string"==typeof e.contentType&&s.setRequestHeader("Content-Type",e.contentType),s.withCredentials=e.withCredentials,s.send(null)}else if("post"==e.type.toLocaleLowerCase()){s.open("POST",e.baseUrl+e.url,e.async),1==e.async&&(s.timeout=e.timeout);for(let t in e.headers)s.setRequestHeader(t,e.headers[t]);"string"==typeof e.contentType&&s.setRequestHeader("Content-Type",e.contentType),e.processData&&(e.data=this.__getParams(e.data)),s.withCredentials=e.withCredentials,s.send(e.data)}const n=function(){s.abort()};"function"==typeof e.cancelRequest&&e.cancelRequest.apply(this,[n])}}))}post(e,t){let o={url:e,data:t,type:"post"};return this.create(o)}get(e,t){let o={url:e,data:t,type:"get"};return this.create(o)}},Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
